<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Animazione Interattiva con Messaggio Utente</title>
<style>
/* Sfondo full-screen immagini/video */
img, video {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: 1;
    transition: filter 0.1s ease;
}

/* Pulsanti stile vignetta */
.vignette-btn {
    position: absolute;
    padding: 15px 25px;
    font-size: 20px;
    font-family: monospace, sans-serif;
    color: #fff;
    background-color: rgba(0,0,0,0.6);
    border: 3px solid #fff;
    border-radius: 25px;
    cursor: pointer;
    z-index: 10;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    overflow: hidden;
    transition: transform 0.2s, background-color 0.2s;
}
.vignette-btn:hover { background-color: rgba(0,0,0,0.8); }

/* Pulsanti desktop */
#startBtn { top: 20%; left: 50%; transform: translate(-50%, -50%); }
#openBtn { top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; }

/* Messaggio finale desktop */
#finalMessage {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 38px;
    font-family: monospace, sans-serif;
    color: #000;
    padding: 20px 30px;
    border-radius: 15px;
    z-index: 11;
    text-align: center;
    display: none;
    background-color: transparent;
    white-space: pre;
    max-width: 90%;
    word-wrap: break-word;
}

/* Input messaggio */
#messageInputContainer {
    display: none;
    text-align: center;
    position: absolute;
    top: 55%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 12;
}
#userMessage { width: 250px; font-size: 20px; padding: 6px; }
#sendMessage, #noThanks { font-size: 20px; padding: 6px 12px; margin-left: 5px; cursor: pointer; }

/* Mobile */
@media screen and (max-width:1000px){
    .vignette-btn { font-size:50px; padding:12px 18px; }
    #startBtn { top: 15%; left: 50%; transform: translate(-50%, -50%); }
    #openBtn { top: 52%; left: 50%; transform: translate(-50%, -50%); }
    #finalMessage { font-size: 65px; padding:30px; top:45%; left:50%; transform: translate(-50%, -50%); white-space: normal; max-width: 90%; word-wrap: break-word; text-align:center;}
    #userMessage { width: 200px; font-size: 24px; }
    #sendMessage, #noThanks { font-size: 24px; padding: 8px 15px; }

    #messageInputContainer {
        top: 68%;
        width: 80%;
    }
}
</style>
</head>
<body>

<!-- Contenuti fullscreen -->
<img id="letterbox" src="letterboxbasic.png" alt="Letterbox Basic">
<video id="video" src="animazione.mp4" style="display:none;"></video>
<img id="openImage" src="open.png" alt="Open Image" style="display:none;">

<!-- Pulsanti -->
<button id="startBtn" class="vignette-btn"></button>
<button id="openBtn" class="vignette-btn"></button>

<div id="finalMessage"></div>

<div id="messageInputContainer">
    <input type="text" id="userMessage" placeholder="Leave a message..." maxlength="200">
    <button id="sendMessage">Send</button>
    <button id="noThanks">No Thanks</button>
</div>

<audio id="openLetterBoxAudio" src="openletterbox.wav"></audio>
<audio id="fairyAudio" src="fairy.wav"></audio>

<script>
const startBtn = document.getElementById('startBtn');
const openBtn = document.getElementById('openBtn');
const video = document.getElementById('video');
const letterbox = document.getElementById('letterbox');
const openImage = document.getElementById('openImage');
const finalMessage = document.getElementById('finalMessage');
const messageInputContainer = document.getElementById('messageInputContainer');
const userMessageInput = document.getElementById('userMessage');
const sendMessage = document.getElementById('sendMessage');
const noThanks = document.getElementById('noThanks');

const openLetterBoxAudio = document.getElementById('openLetterBoxAudio');
const fairyAudio = document.getElementById('fairyAudio');

const phrases = [
    "Hey, just thinking about you!",
    "Hope your day is going great!",
    "You always make me laugh!",
    "Can’t wait to see you again soon.",
    "You’re my favorite notification.",
    "I was smiling just thinking about you.",
    "You make ordinary moments special.",
    "Life’s better with your smile around.",
    "Thanks for being amazing, as always.",
    "You make me feel lucky every day."
];

const bannedWords = [
  "fuck","death","die","hate","hating","shit","fanculo","morte",
  "troia","puttana","asshole","卐","Israel","stronza","sesso",
  "sex","mammt","muori","morire","genocidio","cazzo","coglione",
  "merda","bastardo","stronch*","teste","vaffanculo","schifoso",
  "lurido","deficiente","bitch","bastard","asshole","dumbass",
  "crap","dick","piss","slut","whore","faggot","motherfucker",
  "pene","vagina"
];

function containsBannedWords(text) {
  const lowerText = text.toLowerCase();
  return bannedWords.some(word => word.endsWith("*") ? lowerText.includes(word.slice(0,-1)) : lowerText.includes(word));
}

// Recupera messaggio salvato da localStorage
let userMessage = localStorage.getItem('savedMessage') || null;

// Macchina da scrivere
function typeWriter(element, text, speed = 100, callback=null) {
    element.textContent = "";
    let i=0;
    const interval = setInterval(()=>{
        element.textContent += text.charAt(i);
        i++;
        if(i>=text.length){
            clearInterval(interval);
            if(callback) callback();
        }
    }, speed);
}

// Reset animazione
function resetAnimation(){
    letterbox.style.display='block';
    video.style.display='none';
    openImage.style.display='none';
    finalMessage.style.display='none';
    openBtn.style.display='none';
    startBtn.style.display='block';
    messageInputContainer.style.display='none';
    userMessageInput.value='';
    typeWriter(startBtn,"Any letters for me?",100);
}

// Mostra startBtn
typeWriter(startBtn,"Any letters for me?",100);

// Click startBtn
startBtn.addEventListener('click',()=>{
    openLetterBoxAudio.play();
    startBtn.style.display='none';
    letterbox.style.display='none';
    video.style.display='block';
    video.muted=true;
    video.load();
    video.play().catch(e=>console.log(e));
});

// Fine video
video.addEventListener('ended',()=>{
    openBtn.style.display='block';
    typeWriter(openBtn,"Open?",100);
});

// Click openBtn
openBtn.addEventListener('click',()=>{
    fairyAudio.play();
    openBtn.style.display='none';
    video.style.display='none';
    openImage.style.display='block';

    // sfocatura graduale
    openImage.style.filter='blur(0px)';
    let blurAmount=0;
    const blurInterval=setInterval(()=>{
        blurAmount+=0.3;
        openImage.style.filter=`blur(${blurAmount}px)`;
        if(blurAmount>=4) clearInterval(blurInterval);
    },30);

    // Messaggio finale
    const messageToShow = userMessage ? userMessage : phrases[Math.floor(Math.random()*phrases.length)];
    finalMessage.style.display='block';
    finalMessage.textContent = messageToShow;

    // Mostra input messaggio
    messageInputContainer.style.display='block';
    if(userMessage) userMessageInput.value = userMessage;
});

// Limit 20 parole
userMessageInput.addEventListener('input',()=>{
    const words = userMessageInput.value.split(/\s+/);
    if(words.length>20){
        userMessageInput.value = words.slice(0,20).join(' ');
    }
});

// Send
sendMessage.addEventListener('click',()=>{
    const input = userMessageInput.value.trim();
    if(input.split(/\s+/).length > 20){
        alert("Max 20 words allowed!");
        return;
    }
    if(containsBannedWords(input)){
        alert("Your message contains forbidden words!");
        return;
    }
    userMessage = input;

    // Salva in localStorage
    localStorage.setItem('savedMessage', userMessage);

    resetAnimation();
});

// No Thanks
noThanks.addEventListener('click',()=>{
    // non cancelliamo il messaggio salvato
    resetAnimation();
});
</script>
</body>
</html>
